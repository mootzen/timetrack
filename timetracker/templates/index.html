<!DOCTYPE html>
<html lang="en" data-theme="{{ 'dark' if session.get('dark_mode') else 'light' }}">
<head>
    <meta charset="UTF-8">
    <title>Uhrensohn</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        const startTime = "{{ start_dt_iso }}";

        function updateElapsed() {
            if (!startTime) return;

            const start = new Date(startTime);
            const now = new Date();
            const diffMs = now - start;

            if (diffMs < 0) return;

            const totalSeconds = Math.floor(diffMs / 1000);
            const hrs = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const mins = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const secs = String(totalSeconds % 60).padStart(2, '0');

            const el = document.getElementById('elapsed');
            if (el) {
                el.textContent = `${hrs}:${mins}:${secs}`;
            }
        }

        if (startTime) {
            setInterval(updateElapsed, 1000);
        }
    </script>
</head>
<body>
    <img src="{{ url_for('static', filename='uhrensohn-v3.png') }}" alt="Uhrensohn logo" class="logo">
    <div class="container">
        <h1>⏱️ Uhrensohn - AZ-Erfassung</h1>
        <form action="/start" method="post"><button class="button">▶️ Start</button></form>
        <form action="/stop" method="post"><button class="button">⏹️ Stop</button></form>
        <form action="/logout" method="post"><button class="button">🚪 Logout</button></form>
        <a href="/history" class="link">📜 History</a>
        <a href="/settings" class="link">⚙️ Settings</a>

        {% if status %}
        <div class="status">
            <p><strong>Status:</strong> {{ status }}</p>
            {% if start_time %}
            <p><strong>Start Time:</strong> {{ start_time }}</p>
            {% endif %}
            {% if elapsed %}
            <p><strong>Elapsed:</strong> <span id="elapsed">{{ elapsed }}</span></p>
            {% endif %}
        </div>
        {% endif %}

        <div class="summary">
            <h2>📈 Progress</h2>
            <p><strong>Worked today:</strong> {{ worked_today }} / {{ expected_today }} ({{ percent_today }}%)</p>
            <p><strong>Worked this week:</strong> {{ worked_week }} / {{ expected_week }} ({{ percent_week }}%)</p>
        </div>
    </div>
</body>
</html>
